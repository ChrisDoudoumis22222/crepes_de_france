<!DOCTYPE html>
<html lang="gr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Μενού με Καλάθι - Crepe de France</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet" />
  <style>
:root {
  --primary-color: #ff7a00;
  --secondary-color: #e64a19;
  --accent-color: #28a745;
  --background-color: #f5f5f5;
  --text-color: #121212;
  --light-text: #555555;
  --card-bg: #ffffff;
  --shadow-color: rgba(0, 0, 0, 0.1);
  --transition-speed: 0.3s;
  --border-radius: 15px;
  --font-family: 'Montserrat', sans-serif;
  --icon-size: 60px;
  --btn-hover-scale: 1.05;
  --modal-bg: rgba(0, 0, 0, 0.6);
  --modal-content-bg: #ffffff;
  --notification-bg: #28a745;
  --notification-text: #ffffff;
  --notification-padding: 10px 20px;
  --notification-border-radius: 5px;
  --notification-box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  --notification-font-size: 1em;
}

*, *::before, *::after {
  box-sizing: border-box;
}

html, body {
  height: 100%;
  overflow-y: auto; /* Ensure the page can scroll */
}

body {
  margin: 0;
  padding: 0;
  font-family: var(--font-family);
  background-color: var(--background-color);
  color: var(--text-color);
  line-height: 1.6;
}

header {
  background-color: var(--card-bg);
  padding: 20px;
  text-align: center;
  position: relative;
  border-bottom: 1px solid #e0e0e0;
  box-shadow: 0 2px 4px var(--shadow-color);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

header h1 {
  margin: 10px 0;
  font-size: 2.5em;
  color: var(--primary-color);
  font-weight: 600;
  text-transform: uppercase;
}

.back-button {
  position: absolute;
  left: 20px;
  top: 50%;
  transform: translateY(-50%);
  background-color: var(--primary-color);
  color: #ffffff;
  border: none;
  padding: 10px 20px;
  border-radius: 5px;
  cursor: pointer;
  font-size: 1em;
  transition: background-color var(--transition-speed), transform var(--transition-speed);
  display: flex;
  align-items: center;
  gap: 8px;
  text-decoration: none;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.back-button:hover,
.back-button:focus {
  background-color: var(--secondary-color);
  transform: translateY(-2px);
  outline: none;
}

.cart-button {
  position: absolute;
  right: 20px;
  top: 20px;
  background-color: transparent;
  border: none;
  cursor: pointer;
  transition: transform var(--transition-speed);
  display: flex;
  align-items: center;
  justify-content: center;
}

.cart-button img {
  width: 35px;
  height: 35px;
}

.cart-button:hover,
.cart-button:focus {
  transform: scale(1.1);
  outline: none;
}

.login-button {
  position: absolute;
  right: 80px;
  top: 20px;
  background-color: transparent;
  border: none;
  cursor: pointer;
  transition: transform var(--transition-speed);
  display: flex;
  align-items: center;
  justify-content: center;
}

.login-button img {
  width: 30px;
  height: 30px;
}

.login-button:hover,
.login-button:focus {
  transform: scale(1.1);
  outline: none;
}

#notification-container {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 3000;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.notification {
  background: var(--notification-bg);
  color: var(--notification-text);
  padding: var(--notification-padding);
  border-radius: var(--notification-border-radius);
  box-shadow: var(--notification-box-shadow);
  font-size: var(--notification-font-size);
  animation: fadeIn 0.5s forwards;
}

@keyframes fadeOut {
  from {opacity: 1; transform: translateY(0);}
  to {opacity: 0; transform: translateY(-10px);}
}

.fade-out {
  animation: fadeOut 0.5s forwards;
}

.container {
  max-width: 1200px;
  margin: 20px auto;
  padding: 10px;
  overflow-y: visible; /* Ensure the container can grow and scroll */
}

.category-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 20px;
  margin-bottom: 40px;
}

.category-card {
  background-color: var(--card-bg);
  padding: 20px;
  border-radius: var(--border-radius);
  box-shadow: 0 4px 8px var(--shadow-color);
  text-align: center;
  transition: transform var(--transition-speed) ease-in-out, box-shadow var(--transition-speed);
  cursor: pointer;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.category-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
}

.category-card h2 {
  color: var(--primary-color);
  font-size: 1.2em;
  margin-top: 10px;
  text-transform: capitalize;
}

.menu-section {
  margin-bottom: 40px;
}

h2.menu-section-title {
  color: var(--primary-color);
  font-size: 2em;
  padding: 10px 0;
  margin-bottom: 20px;
  text-align: left;
  border-bottom: 2px solid var(--primary-color);
  text-transform: capitalize;
  font-weight: 600;
}

.menu-item {
  display: flex;
  align-items: center;
  background-color: var(--card-bg);
  padding: 20px;
  border-radius: var(--border-radius);
  margin-bottom: 20px;
  box-shadow: 0 4px 8px var(--shadow-color);
  transition: transform var(--transition-speed) ease-in-out;
  cursor: pointer;
}

.menu-item:hover {
  transform: scale(1.02);
}

.menu-item img {
  width: 120px;
  height: 120px;
  border-radius: var(--border-radius);
  object-fit: cover;
  transition: transform var(--transition-speed);
}

.menu-item:hover img {
  transform: scale(1.05);
}

.menu-item-info {
  flex-grow: 1;
  padding-left: 20px;
}

.menu-item-info h3 {
  color: var(--text-color);
  font-size: 1.4em;
  margin: 0;
  text-transform: uppercase;
  font-weight: 600;
}

.menu-item-info p {
  color: var(--light-text);
  font-size: 1em;
  margin: 5px 0;
}

.menu-item-info a {
  text-decoration: none;
  color: var(--primary-color);
  font-weight: bold;
  transition: color var(--transition-speed);
}

.menu-item-info a:hover,
.menu-item-info a:focus {
  color: var(--secondary-color);
  outline: none;
}

.add-to-cart-btn {
  width: 40px;
  height: 40px;
  border: 2px solid var(--accent-color);
  background-color: var(--accent-color);
  border-radius: 50%;
  cursor: pointer;
  margin-left: auto;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  transition: background-color var(--transition-speed), transform var(--transition-speed);
  position: relative;
}

.add-to-cart-btn::after {
  content: '+';
  color: #ffffff;
  font-size: 24px;
  line-height: 24px;
  font-weight: bold;
}

.add-to-cart-btn:hover,
.add-to-cart-btn:focus {
  background-color: var(--secondary-color);
  transform: scale(1.1);
  outline: none;
}

.cart-popup {
  position: fixed;
  top: 20px;
  right: 20px;
  background-color: var(--card-bg);
  color: var(--text-color);
  padding: 20px;
  border-radius: var(--border-radius);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  width: 300px;
  opacity: 0;
  visibility: hidden;
  transform: translateY(-20px);
  transition: opacity 0.5s ease, transform 0.5s ease, visibility 0.5s;
  z-index: 1000;
}

.cart-popup.visible {
  opacity: 1;
  visibility: visible;
  transform: translateY(0);
}

.cart-popup h3 {
  margin-top: 0;
  color: var(--primary-color);
  text-align: center;
  font-size: 1.8em;
  font-weight: 600;
}

.cart-item {
  display: flex;
  justify-content: space-between;
  margin-bottom: 10px;
  font-size: 1em;
}

.total {
  text-align: right;
  font-size: 1.2em;
  margin-top: 10px;
  color: var(--primary-color);
  font-weight: 600;
}

.close-popup {
  position: absolute;
  top: 10px;
  right: 15px;
  background: none;
  border: none;
  font-size: 1.5em;
  cursor: pointer;
  color: var(--primary-color);
  transition: color var(--transition-speed);
}

.close-popup:hover,
.close-popup:focus {
  color: var(--secondary-color);
  outline: none;
}

.checkout-btn {
  background: linear-gradient(45deg, var(--primary-color), #ffcc00);
  color: #ffffff;
  border: none;
  padding: 12px 20px;
  border-radius: 30px;
  font-size: 1em;
  cursor: pointer;
  transition: background 0.3s, transform 0.3s;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  margin-top: 20px;
  font-weight: 600;
}

.checkout-btn:hover,
.checkout-btn:focus {
  background: linear-gradient(45deg, var(--secondary-color), #e6b800);
  transform: scale(1.05);
  outline: none;
}

.checkout-btn img {
  width: 20px;
  height: 20px;
  margin-right: 10px;
}

.customization-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: var(--modal-bg);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 2000;
  overflow-y: auto; /* Enable scrolling within the modal */
}

.customization-modal.active {
  display: flex;
}

.modal-content {
  background-color: var(--modal-content-bg);
  padding: 30px;
  border-radius: var(--border-radius);
  width: 90%;
  max-width: 500px;
  position: relative;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  animation: fadeIn 0.3s ease-in-out;
  max-height: 90vh; /* Prevent modal from exceeding viewport height */
  overflow-y: auto; /* Enable scrolling within modal if content is too long */
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-50px); }
  to { opacity: 1; transform: translateY(0); }
}

.modal-content h2 {
  margin-top: 0;
  color: var(--primary-color);
  font-size: 1.8em;
  text-align: center;
  font-weight: 600;
}

.modal-content .extras {
  margin: 20px 0;
}

.modal-content .extras h3 {
  font-size: 1.2em;
  color: var(--secondary-color);
  margin-bottom: 10px;
}

.modal-content .extras label {
  display: flex;
  align-items: center;
  margin-bottom: 10px;
  font-size: 1em;
  cursor: pointer;
}

.modal-content .extras input[type="checkbox"] {
  margin-right: 10px;
  width: 18px;
  height: 18px;
  cursor: pointer;
}

.modal-content .total-price {
  font-size: 1.2em;
  text-align: right;
  color: var(--primary-color);
  margin-top: 10px;
  font-weight: 600;
}

.modal-content .modal-buttons {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
  margin-top: 20px;
}

.modal-content .modal-buttons button {
  padding: 10px 20px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 1em;
  transition: background-color var(--transition-speed), transform var(--transition-speed);
  font-weight: 600;
}

.modal-content .modal-buttons .cancel-btn {
  background-color: #cccccc;
  color: #333333;
}

.modal-content .modal-buttons .cancel-btn:hover,
.modal-content .modal-buttons .cancel-btn:focus {
  background-color: #b3b3b3;
  transform: translateY(-2px);
  outline: none;
}

.modal-content .modal-buttons .add-btn {
  background-color: var(--accent-color);
  color: #ffffff;
}

.modal-content .modal-buttons .add-btn:hover,
.modal-content .modal-buttons .add-btn:focus {
  background-color: #1e7e34;
  transform: translateY(-2px);
  outline: none;
}

.login-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: var(--modal-bg);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 2500;
  overflow-y: auto; /* Enable scrolling within the modal */
}

.login-modal.active {
  display: flex;
}

.login-modal .modal-content {
  background-color: var(--modal-content-bg);
  padding: 30px;
  border-radius: var(--border-radius);
  width: 90%;
  max-width: 400px;
  position: relative;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  animation: fadeIn 0.3s ease-in-out;
  max-height: 90vh; /* Prevent modal from exceeding viewport height */
  overflow-y: auto; /* Enable scrolling within modal if content is too long */
}

.login-modal .modal-content h2 {
  margin-top: 0;
  color: var(--primary-color);
  font-size: 1.8em;
  text-align: center;
  font-weight: 600;
}

.login-modal .modal-content form {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.login-modal .modal-content form label {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  font-size: 1em;
  color: var(--text-color);
}

.login-modal .modal-content form input {
  width: 100%;
  padding: 8px 10px;
  margin-top: 5px;
  border: 1px solid #cccccc;
  border-radius: 5px;
  font-size: 1em;
}

.login-modal .modal-content .modal-buttons {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
  margin-top: 20px;
}

/* Responsive Adjustments */
@media (max-width: 768px) {
  .menu-item {
    flex-direction: column;
    align-items: flex-start;
  }
  .menu-item img {
    width: 100%;
    height: auto;
    border-radius: 10px;
  }
  .menu-item-info {
    padding-left: 0;
    padding-top: 10px;
  }
  .category-container {
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  }
  .category-card h2 {
    font-size: 1em;
  }
  .add-to-cart-btn {
    width: 35px;
    height: 35px;
  }
  .menu-section-title {
    font-size: 1.8em;
  }
  .menu-item-info h3 {
    font-size: 1.2em;
  }
  .checkout-btn {
    padding: 10px 16px;
    font-size: 0.9em;
  }
  header {
    padding: 15px;
  }
  .cart-button {
    right: 60px;
  }
  .login-button {
    right: 20px;
  }

  /* Responsive Cart Popup */
  .cart-popup {
    width: 90%;
    max-width: 350px;
  }

  /* Responsive Customization Modal */
  .modal-content {
    padding: 20px;
    max-width: 90%;
  }

  /* Responsive Login Modal */
  .login-modal .modal-content {
    padding: 20px;
    max-width: 90%;
  }
}

@media (max-width: 600px) {
  .category-container {
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
  }
  .category-card {
    padding: 15px;
  }
  .menu-section-title {
    font-size: 1.6em;
  }
  .menu-item-info h3 {
    font-size: 1em;
  }
  .checkout-btn {
    padding: 8px 14px;
    font-size: 0.8em;
  }

  /* Make cart-popup full width on very small screens */
  .cart-popup {
    width: 95%;
    max-width: 400px;
  }

  /* Make customization modal full width on very small screens */
  .modal-content {
    padding: 15px;
    max-width: 95%;
  }

  /* Make login modal full width on very small screens */
  .login-modal .modal-content {
    padding: 15px;
    max-width: 95%;
  }
}


  </style>
</head>
<body>
  <!-- Header Section -->
  <header>
    <img src="https://cdn.e-food.gr/shop/762805/logo?t=1647428522" alt="Crepe de France Logo" width="150"/>
    <h1>Μενού Crepe de France</h1>
    <button class="login-button" onclick="openLoginModal()" aria-label="Σύνδεση">
      <img src="https://img.icons8.com/ios-filled/50/000000/login-rounded-right.png" alt="Σύνδεση"/>
    </button>
    <button class="cart-button" onclick="showCartPopup()" aria-label="Προβολή Καλαθιού">
      <img src="https://cdn-icons-png.flaticon.com/512/34/34568.png" alt="Καλάθι"/>
    </button>
  </header>
  
  <!-- Notification Container -->
  <div id="notification-container"></div>
  
  <!-- Main Content Container -->
  <div class="container">
    <div class="category-container"></div>
    <div class="menu-sections"></div>
  </div>
  
  <!-- Cart Popup -->
  <div class="cart-popup" id="cart-popup">
    <button class="close-popup" onclick="hideCartPopup()" aria-label="Κλείσιμο Καλαθιού">×</button>
    <h3>Περίληψη Καλαθιού</h3>
    <div id="cart-summary"></div>
    <div class="total">Σύνολο: <span id="popup-total-price">0.00€</span></div>
    <button class="checkout-btn" onclick="window.location.href='checkout.html'" aria-label="Ολοκλήρωση Παραγγελίας">
      <img src="https://cdn-icons-png.flaticon.com/512/126/126083.png" alt="Εικονίδιο Ολοκλήρωσης Παραγγελίας"/>
      Πηγαίνετε στο Ταμείο
    </button>
  </div>
  
  <!-- Customization Modal -->
  <div class="customization-modal" id="customization-modal">
    <div class="modal-content">
      <h2 id="modal-item-name">Προσαρμογή Προϊόντος</h2>
      <div class="extras" id="modal-extras"></div>
      <div class="total-price">Σύνολο: <span id="modal-total-price">0.00€</span></div>
      <div class="modal-buttons">
        <button class="cancel-btn" onclick="closeCustomizationModal()" aria-label="Άκυρο">Άκυρο</button>
        <button class="add-btn" onclick="addCustomItemToCart()" aria-label="Προσθήκη στο Καλάθι">Προσθήκη</button>
      </div>
    </div>
  </div>
  
  <!-- Login Modal -->
  <div class="login-modal" id="login-modal">
    <div class="modal-content">
      <h2>Σύνδεση</h2>
      <form id="login-form">
        <label for="username">Όνομα Χρήστη:</label>
        <input type="text" id="username" name="username" required/>
        <label for="password">Κωδικός:</label>
        <input type="password" id="password" name="password" required/>
        <div class="modal-buttons">
          <button type="button" class="cancel-btn" onclick="closeLoginModal()" aria-label="Άκυρο">Άκυρο</button>
          <button type="submit" class="add-btn" aria-label="Σύνδεση">Σύνδεση</button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Load the data file FIRST -->
  <script src="menuData.js"></script>
  
  <!-- Main Script that references window.menuData, etc. -->
  <script>
    let cart = JSON.parse(localStorage.getItem('cart')) || [];

    // Render the menu on page load
    window.onload = () => {
      renderMenu();
      updateCartPopup();
    };

    function renderMenu() {
      const categoryContainer = document.querySelector('.category-container');
      const menuSectionsContainer = document.querySelector('.menu-sections');
      categoryContainer.innerHTML = '';
      menuSectionsContainer.innerHTML = '';

      // Loop each category
      for (const categoryKey in window.menuData) {
        const categoryItems = window.menuData[categoryKey];
        const categoryCard = document.createElement('div');
        categoryCard.classList.add('category-card');
        categoryCard.setAttribute('data-category', categoryKey);

        // Smooth scroll to relevant section
        categoryCard.addEventListener('click', () => {
          const sectionDiv = document.getElementById(`section-${categoryKey}`);
          if (sectionDiv) {
            window.scrollTo({
              top: sectionDiv.offsetTop - 20,
              behavior: 'smooth'
            });
          }
        });

        // Category Title
        const categoryTitle = document.createElement('h2');
        categoryTitle.textContent = getCategoryDisplayName(categoryKey);
        categoryCard.appendChild(categoryTitle);
        categoryContainer.appendChild(categoryCard);

        // Build the section
        const sectionDiv = document.createElement('div');
        sectionDiv.classList.add('menu-section');
        sectionDiv.id = `section-${categoryKey}`;

        const sectionTitle = document.createElement('h2');
        sectionTitle.classList.add('menu-section-title');
        sectionTitle.textContent = getCategoryDisplayName(categoryKey);
        sectionDiv.appendChild(sectionTitle);

        categoryItems.forEach((item) => {
          const itemDiv = document.createElement('div');
          itemDiv.classList.add('menu-item');

          // Image if provided
          if (item.imageUrl) {
            const itemImage = document.createElement('img');
            itemImage.src = item.imageUrl;
            itemImage.alt = item.name.el;
            itemDiv.appendChild(itemImage);
          }

          // Info block
          const itemInfo = document.createElement('div');
          itemInfo.classList.add('menu-item-info');

          const itemName = document.createElement('h3');
          itemName.textContent = item.name.el;
          itemInfo.appendChild(itemName);

          // **FIX HERE**: Check if item.description exists before accessing 'el'
          if (item.description && item.description.el && item.description.el !== 'N/A') {
            const itemDesc = document.createElement('p');
            itemDesc.textContent = item.description.el;
            itemInfo.appendChild(itemDesc);
          }

          const itemPrice = document.createElement('p');
          itemPrice.textContent = `Τιμή: ${item.price}`;
          itemInfo.appendChild(itemPrice);

          // If it's one of the custom categories, add a "Customize" button
          if (isCustomCategory(categoryKey)) {
            const customizeBtn = document.createElement('button');
            customizeBtn.textContent = `Φτιάξε την δική σου ${item.name.el}`;
            customizeBtn.classList.add('customize-btn');
            customizeBtn.style.background = 'none';
            customizeBtn.style.border = 'none';
            customizeBtn.style.color = 'var(--primary-color)';
            customizeBtn.style.cursor = 'pointer';
            customizeBtn.style.fontWeight = 'bold';
            customizeBtn.style.marginTop = '10px';
            customizeBtn.style.padding = '0';
            customizeBtn.style.fontSize = '1em';

            customizeBtn.addEventListener('click', (e) => {
              e.stopPropagation();
              openCustomizationModal(categoryKey, item);
            });
            itemInfo.appendChild(customizeBtn);
          }

          itemDiv.appendChild(itemInfo);

          // Add-to-cart button
          const addToCartBtn = document.createElement('button');
          addToCartBtn.classList.add('add-to-cart-btn');
          addToCartBtn.title = 'Προσθήκη στο Καλάθι';
          addToCartBtn.setAttribute('aria-label', `Προσθήκη ${item.name.el} στο Καλάθι`);
          addToCartBtn.onclick = (e) => {
            e.stopPropagation();
            addToCart(item);
          };

          itemDiv.appendChild(addToCartBtn);
          sectionDiv.appendChild(itemDiv);
        });

        menuSectionsContainer.appendChild(sectionDiv);
      }
    }

    function getCategoryDisplayName(categoryKey) {
      // Adjust or add to this mapping if you need
      const mapping = {
        "dimofilestera": "Δημοφιλέστερα",
        "almyres-krepes": "Αλμυρές Κρέπες",
        "glykes-krepes": "Γλυκές Κρέπες",
        "rofimata": "Ροφήματα",
        "granites": "Γρανίτες",
        "smoothies": "Smoothies",
        "milkshakes": "Milkshakes",
        "toasts": "Toasts",
        "pancakes-almyra": "Pancakes Αλμυρά",
        "pancakes-glyka": "Pancakes Γλυκά",
        "club-sandwiches": "Club Sandwiches",
        "froytosalates-epidorpia": "Φρουτοσαλάτες & Επιδόρπια",
        "vafles": "Βάφλες",
        "my-crepa": "My Crepa",
        "my-waffle": "My Waffle",
        "my-pancake": "My Pancake",
        "pagota-se-kypelaki": "Παγωτά σε Κυπελάκι",
        "salates": "Σαλάτες",
        "burgers": "Burgers",
        "anapsyktika": "Αναψυκτικά",
        "mpyres-potaje": "Μπύρες & Ποτά"
      };
      return mapping[categoryKey] || categoryKey;
    }

    function isCustomCategory(category) {
      // If you consider these 3 as "custom" categories
      return ["my-crepa", "my-waffle", "my-pancake"].includes(category);
    }

    function addToCart(item) {
      cart.push(item);
      localStorage.setItem('cart', JSON.stringify(cart));
      updateCartPopup();
      showCartPopup();
      showNotification("Προστέθηκε στο Καλάθι", `${item.name.el} προστέθηκε με επιτυχία.`);
    }

    function updateCartPopup() {
      const cartSummary = document.getElementById('cart-summary');
      cartSummary.innerHTML = '';
      let total = 0;
      if (cart.length === 0) {
        cartSummary.innerHTML = '<p>Το καλάθι σας είναι άδειο.</p>';
      } else {
        cart.forEach((item) => {
          const cartItemDiv = document.createElement('div');
          cartItemDiv.classList.add('cart-item');
          const itemName = document.createElement('p');
          itemName.textContent = item.name.el;
          const itemPrice = document.createElement('p');
          itemPrice.textContent = item.price;
          cartItemDiv.appendChild(itemName);
          cartItemDiv.appendChild(itemPrice);
          cartSummary.appendChild(cartItemDiv);
          
          // Extract numerical value from price
          const priceNumber = parseFloat(
            item.price.replace('€', '').replace(',', '.').replace('Από ', '')
          );
          if (!isNaN(priceNumber)) {
            total += priceNumber;
          }
        });
      }
      document.getElementById('popup-total-price').textContent = `${total.toFixed(2)}€`;
    }

    function showCartPopup() {
      const cartPopup = document.getElementById('cart-popup');
      cartPopup.classList.add('visible');
      // Auto-hide after 3 seconds
      setTimeout(() => {
        hideCartPopup();
      }, 3000);
    }

    function hideCartPopup() {
      const cartPopup = document.getElementById('cart-popup');
      cartPopup.classList.remove('visible');
    }

    // Customization Modal Functions
    let currentCustomItem = null;
    let selectedAddOns = [];

    function openCustomizationModal(category, item) {
      currentCustomItem = item;
      selectedAddOns = [];

      const modal = document.getElementById('customization-modal');
      const modalItemName = document.getElementById('modal-item-name');
      const modalExtras = document.getElementById('modal-extras');
      const modalTotalPrice = document.getElementById('modal-total-price');

      // Set the item name
      modalItemName.textContent = `Προσαρμογή: ${item.name.el}`;

      // Clear previous extras
      modalExtras.innerHTML = '<h3>Επιλογές Προσθέτων</h3>';

      // Get available extras from extrasConfig
      const availableExtras = window.extrasConfig[category] || [];

      if (availableExtras.length === 0) {
        modalExtras.innerHTML += '<p>Δεν υπάρχουν διαθέσιμες προσθήκες.</p>';
      } else {
        // For each "group" of extras
        availableExtras.forEach(group => {
          const groupHeader = document.createElement('h4');
          groupHeader.textContent = group.group.el;
          modalExtras.appendChild(groupHeader);

          // For each option in that group
          group.options.forEach(option => {
            const label = document.createElement('label');
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';

            // Convert price to string with 2 decimals
            const optionPriceStr = option.price.toFixed(2);
            checkbox.value = optionPriceStr;

            // We'll store both the name (EL) and the price
            checkbox.dataset.addonName = option.name.el;

            checkbox.addEventListener('change', updateTotalPrice);
            label.appendChild(checkbox);

            // e.g. "Φράουλα (+1.50€)"
            label.appendChild(document.createTextNode(
              `${option.name.el} (+${optionPriceStr}€)`
            ));
            modalExtras.appendChild(label);
          });
        });
      }

      // Calculate initial total price
      let basePrice = parseFloat(item.price.replace('€', '').replace(',', '.').replace('Από ', ''));
      if (isNaN(basePrice)) basePrice = 0;
      modalTotalPrice.textContent = `${basePrice.toFixed(2)}€`;

      // Show the modal
      modal.classList.add('active');
    }

    function closeCustomizationModal() {
      const modal = document.getElementById('customization-modal');
      modal.classList.remove('active');
      currentCustomItem = null;
      selectedAddOns = [];
    }

    function updateTotalPrice() {
      const modal = document.getElementById('customization-modal');
      const modalTotalPrice = document.getElementById('modal-total-price');
      const checkboxes = modal.querySelectorAll('input[type="checkbox"]');
      let total = parseFloat(currentCustomItem.price.replace('€', '').replace(',', '.').replace('Από ', '')) || 0;

      selectedAddOns = [];

      checkboxes.forEach(checkbox => {
        if (checkbox.checked) {
          const addonPrice = parseFloat(checkbox.value);
          if (!isNaN(addonPrice)) {
            total += addonPrice;
          }
          selectedAddOns.push(checkbox.dataset.addonName);
        }
      });

      modalTotalPrice.textContent = `${total.toFixed(2)}€`;
    }

    function addCustomItemToCart() {
      if (!currentCustomItem) return;

      // Create a new item object with the selected add-ons and total price
      let basePrice = parseFloat(currentCustomItem.price.replace('€', '').replace(',', '.').replace('Από ', '')) || 0;
      let totalPrice = basePrice;

      // We don't do a second pass on extras; we've already included them in 'updateTotalPrice'.
      // So let's just read the displayed total from the modal:
      const displayedTotalEl = document.getElementById('modal-total-price');
      if (displayedTotalEl) {
        const displayedTotalStr = displayedTotalEl.textContent.replace('€','');
        const displayedTotalNum = parseFloat(displayedTotalStr.replace(',', '.'));
        if (!isNaN(displayedTotalNum)) {
          totalPrice = displayedTotalNum;
        }
      }

      // Combine the add-on names in parentheses
      let customNameSuffix = '';
      if (selectedAddOns.length > 0) {
        customNameSuffix = ` (${selectedAddOns.join(', ')})`;
      }

      const customizedItem = {
        name: {
          el: `${currentCustomItem.name.el}${customNameSuffix}`,
          en: currentCustomItem.name.en
        },
        description: currentCustomItem.description,
        price: `${totalPrice.toFixed(2)}€`,
        imageUrl: currentCustomItem.imageUrl || ''
      };

      addToCart(customizedItem);
      closeCustomizationModal();
    }

    // Function to Show Notification
    function showNotification(title, message) {
      const container = document.getElementById('notification-container');
      const notification = document.createElement('div');
      notification.classList.add('notification');
      notification.innerHTML = `<strong>${title}</strong><br>${message}`;

      container.appendChild(notification);

      // Remove after 3 seconds
      setTimeout(() => {
        notification.classList.add('fade-out');
        notification.addEventListener('animationend', () => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        });
      }, 3000);
    }

    // Login Modal Functions
    function openLoginModal() {
      document.getElementById('login-modal').classList.add('active');
    }
    function closeLoginModal() {
      document.getElementById('login-modal').classList.remove('active');
    }

    // Login form submission
    const loginForm = document.getElementById('login-form');
    if (loginForm) {
      loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        try {
          const response = await fetch('/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password }),
          });
          if (response.ok) {
            window.location.href = '/menuel.html';
          } else {
            const error = await response.json();
            alert(error.error || 'Login failed');
          }
        } catch (err) {
          console.error('Error:', err);
          alert('An error occurred. Please try again.');
        }
      });
    }
  </script>
</body>
</html>
